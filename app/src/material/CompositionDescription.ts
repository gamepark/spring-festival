/** @jsxImportSource @emotion/react */
import { css } from '@emotion/react'
import { CardDescription, ItemContext } from '@gamepark/react-game'
import { MaterialItem } from '@gamepark/rules-api'
import { Composition, CompositionType } from '@gamepark/spring-festival/material/Composition'
import { LocationType } from '@gamepark/spring-festival/material/LocationType'
import { MaterialType } from '@gamepark/spring-festival/material/MaterialType'
import { CompositionHelper } from '@gamepark/spring-festival/rules/helper/CompositionHelper'
import equal from 'fast-deep-equal'
import ColorComposition1 from '../images/composition/color/ColorComposition1.jpg'
import ColorComposition10 from '../images/composition/color/ColorComposition10.jpg'
import ColorComposition11 from '../images/composition/color/ColorComposition11.jpg'
import ColorComposition12 from '../images/composition/color/ColorComposition12.jpg'
import ColorComposition13 from '../images/composition/color/ColorComposition13.jpg'
import ColorComposition14 from '../images/composition/color/ColorComposition14.jpg'
import ColorComposition15 from '../images/composition/color/ColorComposition15.jpg'
import ColorComposition16 from '../images/composition/color/ColorComposition16.jpg'
import ColorComposition17 from '../images/composition/color/ColorComposition17.jpg'
import ColorComposition18 from '../images/composition/color/ColorComposition18.jpg'
import ColorComposition19 from '../images/composition/color/ColorComposition19.jpg'
import ColorComposition2 from '../images/composition/color/ColorComposition2.jpg'
import ColorComposition20 from '../images/composition/color/ColorComposition20.jpg'
import ColorComposition21 from '../images/composition/color/ColorComposition21.jpg'
import ColorComposition22 from '../images/composition/color/ColorComposition22.jpg'
import ColorComposition23 from '../images/composition/color/ColorComposition23.jpg'
import ColorComposition24 from '../images/composition/color/ColorComposition24.jpg'
import ColorComposition25 from '../images/composition/color/ColorComposition25.jpg'
import ColorComposition26 from '../images/composition/color/ColorComposition26.jpg'
import ColorComposition27 from '../images/composition/color/ColorComposition27.jpg'
import ColorComposition28 from '../images/composition/color/ColorComposition28.jpg'
import ColorComposition29 from '../images/composition/color/ColorComposition29.jpg'
import ColorComposition3 from '../images/composition/color/ColorComposition3.jpg'
import ColorComposition30 from '../images/composition/color/ColorComposition30.jpg'
import ColorComposition31 from '../images/composition/color/ColorComposition31.jpg'
import ColorComposition32 from '../images/composition/color/ColorComposition32.jpg'
import ColorComposition33 from '../images/composition/color/ColorComposition33.jpg'
import ColorComposition34 from '../images/composition/color/ColorComposition34.jpg'
import ColorComposition35 from '../images/composition/color/ColorComposition35.jpg'
import ColorComposition36 from '../images/composition/color/ColorComposition36.jpg'
import ColorComposition4 from '../images/composition/color/ColorComposition4.jpg'
import ColorComposition5 from '../images/composition/color/ColorComposition5.jpg'
import ColorComposition6 from '../images/composition/color/ColorComposition6.jpg'
import ColorComposition7 from '../images/composition/color/ColorComposition7.jpg'
import ColorComposition8 from '../images/composition/color/ColorComposition8.jpg'
import ColorComposition9 from '../images/composition/color/ColorComposition9.jpg'
import ColorCompositionBack from '../images/composition/color/ColorCompositionBack.jpg'
import PatternComposition1 from '../images/composition/pattern/PatternComposition1.jpg'
import PatternComposition10 from '../images/composition/pattern/PatternComposition10.jpg'
import PatternComposition11 from '../images/composition/pattern/PatternComposition11.jpg'
import PatternComposition12 from '../images/composition/pattern/PatternComposition12.jpg'
import PatternComposition13 from '../images/composition/pattern/PatternComposition13.jpg'
import PatternComposition14 from '../images/composition/pattern/PatternComposition14.jpg'
import PatternComposition15 from '../images/composition/pattern/PatternComposition15.jpg'
import PatternComposition16 from '../images/composition/pattern/PatternComposition16.jpg'
import PatternComposition17 from '../images/composition/pattern/PatternComposition17.jpg'
import PatternComposition18 from '../images/composition/pattern/PatternComposition18.jpg'
import PatternComposition19 from '../images/composition/pattern/PatternComposition19.jpg'
import PatternComposition2 from '../images/composition/pattern/PatternComposition2.jpg'
import PatternComposition20 from '../images/composition/pattern/PatternComposition20.jpg'
import PatternComposition21 from '../images/composition/pattern/PatternComposition21.jpg'
import PatternComposition22 from '../images/composition/pattern/PatternComposition22.jpg'
import PatternComposition23 from '../images/composition/pattern/PatternComposition23.jpg'
import PatternComposition24 from '../images/composition/pattern/PatternComposition24.jpg'
import PatternComposition25 from '../images/composition/pattern/PatternComposition25.jpg'
import PatternComposition26 from '../images/composition/pattern/PatternComposition26.jpg'
import PatternComposition27 from '../images/composition/pattern/PatternComposition27.jpg'
import PatternComposition28 from '../images/composition/pattern/PatternComposition28.jpg'
import PatternComposition29 from '../images/composition/pattern/PatternComposition29.jpg'
import PatternComposition3 from '../images/composition/pattern/PatternComposition3.jpg'
import PatternComposition30 from '../images/composition/pattern/PatternComposition30.jpg'
import PatternComposition31 from '../images/composition/pattern/PatternComposition31.jpg'
import PatternComposition32 from '../images/composition/pattern/PatternComposition32.jpg'
import PatternComposition33 from '../images/composition/pattern/PatternComposition33.jpg'
import PatternComposition34 from '../images/composition/pattern/PatternComposition34.jpg'
import PatternComposition35 from '../images/composition/pattern/PatternComposition35.jpg'
import PatternComposition36 from '../images/composition/pattern/PatternComposition36.jpg'
import PatternComposition4 from '../images/composition/pattern/PatternComposition4.jpg'
import PatternComposition5 from '../images/composition/pattern/PatternComposition5.jpg'
import PatternComposition6 from '../images/composition/pattern/PatternComposition6.jpg'
import PatternComposition7 from '../images/composition/pattern/PatternComposition7.jpg'
import PatternComposition8 from '../images/composition/pattern/PatternComposition8.jpg'
import PatternComposition9 from '../images/composition/pattern/PatternComposition9.jpg'
import PatternCompositionBack from '../images/composition/pattern/PatternCompositionBack.jpg'

export class CompositionDescription extends CardDescription {
  height = 5
  width = 5

  backImages = {
    [CompositionType.Color]: ColorCompositionBack,
    [CompositionType.Pattern]: PatternCompositionBack
  }
  images = {
    [Composition.ColorComposition1]: ColorComposition1,
    [Composition.ColorComposition2]: ColorComposition2,
    [Composition.ColorComposition3]: ColorComposition3,
    [Composition.ColorComposition4]: ColorComposition4,
    [Composition.ColorComposition5]: ColorComposition5,
    [Composition.ColorComposition6]: ColorComposition6,
    [Composition.ColorComposition7]: ColorComposition7,
    [Composition.ColorComposition8]: ColorComposition8,
    [Composition.ColorComposition9]: ColorComposition9,
    [Composition.ColorComposition10]: ColorComposition10,
    [Composition.ColorComposition11]: ColorComposition11,
    [Composition.ColorComposition12]: ColorComposition12,
    [Composition.ColorComposition13]: ColorComposition13,
    [Composition.ColorComposition14]: ColorComposition14,
    [Composition.ColorComposition15]: ColorComposition15,
    [Composition.ColorComposition16]: ColorComposition16,
    [Composition.ColorComposition17]: ColorComposition17,
    [Composition.ColorComposition18]: ColorComposition18,
    [Composition.ColorComposition19]: ColorComposition19,
    [Composition.ColorComposition20]: ColorComposition20,
    [Composition.ColorComposition21]: ColorComposition21,
    [Composition.ColorComposition22]: ColorComposition22,
    [Composition.ColorComposition23]: ColorComposition23,
    [Composition.ColorComposition24]: ColorComposition24,
    [Composition.ColorComposition25]: ColorComposition25,
    [Composition.ColorComposition26]: ColorComposition26,
    [Composition.ColorComposition27]: ColorComposition27,
    [Composition.ColorComposition28]: ColorComposition28,
    [Composition.ColorComposition29]: ColorComposition29,
    [Composition.ColorComposition30]: ColorComposition30,
    [Composition.ColorComposition31]: ColorComposition31,
    [Composition.ColorComposition32]: ColorComposition32,
    [Composition.ColorComposition33]: ColorComposition33,
    [Composition.ColorComposition34]: ColorComposition34,
    [Composition.ColorComposition35]: ColorComposition35,
    [Composition.ColorComposition36]: ColorComposition36,
    [Composition.PatternComposition1]: PatternComposition1,
    [Composition.PatternComposition2]: PatternComposition2,
    [Composition.PatternComposition3]: PatternComposition3,
    [Composition.PatternComposition4]: PatternComposition4,
    [Composition.PatternComposition5]: PatternComposition5,
    [Composition.PatternComposition6]: PatternComposition6,
    [Composition.PatternComposition7]: PatternComposition7,
    [Composition.PatternComposition8]: PatternComposition8,
    [Composition.PatternComposition9]: PatternComposition9,
    [Composition.PatternComposition10]: PatternComposition10,
    [Composition.PatternComposition11]: PatternComposition11,
    [Composition.PatternComposition12]: PatternComposition12,
    [Composition.PatternComposition13]: PatternComposition13,
    [Composition.PatternComposition14]: PatternComposition14,
    [Composition.PatternComposition15]: PatternComposition15,
    [Composition.PatternComposition16]: PatternComposition16,
    [Composition.PatternComposition17]: PatternComposition17,
    [Composition.PatternComposition18]: PatternComposition18,
    [Composition.PatternComposition19]: PatternComposition19,
    [Composition.PatternComposition20]: PatternComposition20,
    [Composition.PatternComposition21]: PatternComposition21,
    [Composition.PatternComposition22]: PatternComposition22,
    [Composition.PatternComposition23]: PatternComposition23,
    [Composition.PatternComposition24]: PatternComposition24,
    [Composition.PatternComposition25]: PatternComposition25,
    [Composition.PatternComposition26]: PatternComposition26,
    [Composition.PatternComposition27]: PatternComposition27,
    [Composition.PatternComposition28]: PatternComposition28,
    [Composition.PatternComposition29]: PatternComposition29,
    [Composition.PatternComposition30]: PatternComposition30,
    [Composition.PatternComposition31]: PatternComposition31,
    [Composition.PatternComposition32]: PatternComposition32,
    [Composition.PatternComposition33]: PatternComposition33,
    [Composition.PatternComposition34]: PatternComposition34,
    [Composition.PatternComposition35]: PatternComposition35,
    [Composition.PatternComposition36]: PatternComposition36,
  }

  isFlipped(item: Partial<MaterialItem>, context: ItemContext) {
    return super.isFlipped(item, context) || item.location?.type === LocationType.PlayerDoneComposition
  }

  getItemExtraCss(item: MaterialItem, context: ItemContext) {
    if (item.location.type !== LocationType.PlayerComposition) return
    if (!context.player || context.player !== item.location.player) return
    const selectedIndexes = [...context.rules.material(MaterialType.Firework).selected().getIndexes()].sort()
    if (!selectedIndexes.length) return
    const moves = new CompositionHelper(context.rules.game, item.location.player!).compositionMoves
    const valid = moves.some((move) => equal(selectedIndexes, move.data.indexes) && context.index === move.data.comp)
    return css`
      &:after {
        content: '';
        width: 100%;
        height: 100%;
        position: absolute;
        border: 0.2em solid ${valid? 'green': 'red'};
        border-radius: 0.4em
      }
    `
  }

}

export const compositionDescription = new CompositionDescription()